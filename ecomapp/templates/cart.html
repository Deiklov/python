{% extends 'base.html' %}
{% load static %}
{% block content %}
    <table class="table">
        <tr>
            <td class="text-center">Tovar</td>
            <td class="text-center">Quantity</td>
            <td class="text-center">Price</td>
        </tr>
        {% for item in cart.items.all %}
            <tr id="{{ item.product.slug }}">
                <td class="text-center">{{ item.product.title }}</td>
                <td class="text-center">
                    <form action="" method="GET">
                        <input type="number" name="qty" class="cart-item-qty" data-id="{{ item.id }}"
                               value="{{ item.qty }}" min="1" style="width: 50px;">
                    </form>
                </td>
                <td class="text-center" id="cart-item-total-{{ item.id }}">{{ item.item_total }} руб.</td>
                <td class="text-center"><a href="#" class="remove_from_cart" data-slug="{{ item.product.slug }}"
                                           data-id="{{ item.product.id }}">
                    <button class="btn-default">Удалить из корзины</button>
                </a></td>
            </tr>
        {% endfor %}
    </table>
    <script src='{% static "js/jquery.js" %}'></script>
    <script>
        $(document).ready(function () {
            $('.remove_from_cart').on('click', function (e) {
                e.preventDefault()
                product_slug = $(this).attr('data-slug')
                item_product_id = $(this).attr("data-id")
                console.log(item_product_id)
                data = {
                    product_slug: product_slug
                }
                $.ajax({
                    type: "GET",
                    url: '{% url "remove_from_cart" %}',
                    data: data,
                    success: function (data) {
                        $("#cart_count").html(data.cart_total)
                        $('#' + product_slug).remove()
                    }
                })
            })
        })
        $(document).ready(function () {
            $(".cart-item-qty").on('click', function () {
                qty = $(this).val()
                item_id = $(this).attr('data-id')
                data = {
                    qty: qty,
                    item_id: item_id
                }
                $.ajax({
                    type: "GET",
                    url: '{% url 'change_item_qty' %}',
                    data: data,
                    success: function (data) {
                        $('#cart-item-total-' + item_id).html(parseFloat(data.item_total).toFixed(2) + ' руб.')
                    }
                })

            })

        })
    </script>
{% endblock content %}